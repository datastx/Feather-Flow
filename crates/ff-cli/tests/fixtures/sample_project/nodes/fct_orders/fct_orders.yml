version: 1
kind: sql
materialized: table
wap: true
pre_hook: "CREATE TABLE IF NOT EXISTS hook_log (model VARCHAR, hook_type VARCHAR, ts TIMESTAMP DEFAULT current_timestamp)"
post_hook:
  - "INSERT INTO hook_log (model, hook_type) VALUES ('fct_orders', 'post')"
  - "INSERT INTO hook_log (model, hook_type) VALUES ('fct_orders', 'post_2')"

description: "Fact table for orders with customer details and payment information"
owner: analytics-team
tags:
  - marts
  - facts
  - orders

columns:
  - name: order_id
    type: INTEGER
    description: "Unique identifier for the order"
    classification: internal
    tests:
      - unique
      - not_null
  - name: customer_id
    type: INTEGER
    description: "Reference to the customer"
    tests:
      - not_null
  - name: customer_name
    type: VARCHAR
    description: "Customer full name"
    classification: pii
  - name: customer_tier
    type: VARCHAR
    description: "Customer tier at time of order"
  - name: order_date
    type: DATE
    description: "Date the order was placed"
    classification: internal
  - name: amount
    type: DECIMAL(10,2)
    description: "Order amount in dollars"
    classification: sensitive
  - name: status
    type: VARCHAR
    description: "Order status"
  - name: payment_total
    type: DECIMAL(10,2)
    description: "Total payments received"
  - name: payment_count
    type: INTEGER
    description: "Number of payments made"
  - name: balance_due
    type: DECIMAL(10,2)
    description: "Remaining balance (amount - payment_total)"
  - name: payment_ratio
    type: DOUBLE
    description: "Ratio of payments received to order amount (NULL when order amount is zero)"
